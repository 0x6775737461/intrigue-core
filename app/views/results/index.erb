
<div class="row">

<div class="col-sm-2">
  <form class="form-horizontal" id="result_search" target="_self" method="get" action="/<%=h @project_name%>/results">

    Search:
    <input type="text" style='width:100%' class="form-control sm" id="search_string" name="search_string">
    <input id="inverse" name="inverse" type="checkbox"> Inverse <br/>
    <br/><br/>
    <input id="hide_cancelled" name="hide_cancelled" type="checkbox"> Hide Cancelled <br/>
    <input id="hide_enrichment" name="hide_enrichment" type="checkbox"> Hide Enrichment <br/>
    <input id="hide_autoscheduled" name="hide_autoscheduled" type="checkbox"> Hide Autoscheduled <br/>
    <input id="only_complete" name="only_complete" type="checkbox"> Only Complete <br/>
    <input class="btn btn-primary" type="submit" value="Search">
  </form>
  <br>
  <p>
  Result Count: <%= Intrigue::Core::Model::TaskResult.scope_by_project(@project_name).all.count %><br/><br/>
  <a href="<%=request.path%>/all/cancel">Cancel All Tasks</a>
  </p>
</div>

<div class="col-sm-10">

  <div class="float-right">
    <a href="<%=h request.path%>?page=<%=@page-1%>&search_string=<%=@search_string%>">prev</a> | 
    <a href="<%=h request.path%>?page=<%=@page+1%>&search_string=<%=h @search_string%>">next</a> | 
    <%= "Page: #{@page} / Viewing Results: #{@result_count * (@page-1)} .. #{@result_count * @page-1}" %>
  </div>
  
  <script src="/js/sorttable.js"></script>
  <style>
  /* Sortable tables */
  table.sortable {
    width: 100%;
    border: 0;
    table-layout:fixed;
    word-wrap:break-word;
    border-collapse:collapse;
  }

  table.sortable thead {
      background-color:#eee;
      color:#666666;
      font-weight: bold;
      cursor: default;
  }

  </style>
  <p></p>
  <table class="sortable" border="1" width=100%>
    <colgroup>
      <col style="width:20%">  
      <col style="width:65%">
      <col style="width:9%">
      <col style="width:9%">
    </colgroup>
    <tbody>
      <tr>
        <th>Started At</th>
        <th>Task Name</th>
        <th>Entity Count</th>
        <th>Complete</th>
      </tr>
        <% @results.each do |x| %>
        <tr>
          <td>
          <div class='td-words'>
            <%= h x.timestamp_start %> 
          </div>
          </td>
          <td>
            <div class='td-words'>
              <a href="/<%=h @project_name%>/results/<%=x.id%>"><%= h x.task_name %> on <%= h x.base_entity.to_s %></a>
            </div>
          </td>
          <td>
            <div class='td-numbers'>
              <%= h x.entities.uniq.count %> 
            </div>
          </td>
          <td>
            <div class='td-images'>
            <% if  x.complete %>
              <img width=12 height=12 src='/img/icons/checkmark.png'>
            <% else %>
              <img width=12 height=12 src='/img/icons/xmark.png'>
            <% end %>
            </div>
          </td>
        </tr>
        <% end %>
    </tbody>
  </table>

</div>